<div class="home-container">
  <div class="header-section">
    <h1>Notifications</h1>

    @if (userService.isAdmin()) {
    <div class="admin-actions">
      <a routerLink="/notifications/new/edit" class="add-notification-btn header-btn">
        + Add Notification
      </a>
      <a routerLink="/admin" class="admin-btn header-btn"> Admin </a>
    </div>
    }
  </div>

  <div class="filter-section">
    <div class="product-filter">
      <div class="filter-header">
        <h3>Filter by Products</h3>
        <a [href]="rssUrl()" target="_blank" class="rss-link">
          <svg class="rss-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M4 11a9 9 0 0 1 9 9"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
            <path
              d="M4 4a16 16 0 0 1 16 16"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
            <circle cx="5" cy="19" r="1" fill="currentColor" />
          </svg>
          RSS
        </a>
      </div>
      <div class="filter-options">
        <label class="filter-option">
          <input type="checkbox" [checked]="showAllProducts()" (change)="toggleAllProducts()" />
          All Products
        </label>

        @for (product of productService.allProducts(); track product.id) {
        <label class="filter-option">
          <input
            type="checkbox"
            [checked]="selectedProductIds().includes(product.id)"
            (change)="toggleProduct(product.id)"
          />
          {{ product.name }}
        </label>
        }
      </div>
    </div>
  </div>

  <div class="notifications-section">
    @if (notificationService.loading()) {
    <div class="loading-container">
      <div class="loading-spinner">Loading...</div>
    </div>
    } @if (filteredNotifications().length === 0 && !notificationService.loading()) {
    <div class="empty-state">
      <p>No notifications found for the selected products.</p>
    </div>
    }

    <div class="notifications-list">
      @for (notification of filteredNotifications(); track notification.id) {
      <div class="notification-card">
        <div class="notification-header">
          <h2
            class="notification-title"
            [class.expanded]="expandedNotifications().includes(notification.id)"
            (click)="toggleExpanded(notification.id)"
          >
            {{ notification.title }}
          </h2>
          <div class="notification-meta">
            <span class="notification-date">
              {{ notification.datetime | date : 'medium' }}
            </span>
            <div class="affected-products">
              @for (productId of notification.affectedProducts; track productId) { @if
              (getProductById(productId); as product) {
              <span class="product-tag">{{ product.name }}</span>
              } }
            </div>
          </div>
        </div>

        <div class="notification-content">
          @if (expandedNotifications().includes(notification.id)) {
          <p class="notification-description">{{ notification.description }}</p>
          } @else {
          <p class="notification-preview">
            {{ getPreview(notification.description) }}
          </p>
          }

          <div class="notification-actions">
            <a [routerLink]="['/notifications', notification.slug]" class="view-link">
              View Details
            </a>

            @if (userService.isAdmin()) {
            <a [routerLink]="['/notifications', notification.slug, 'edit']" class="edit-link">
              Edit
            </a>
            }
          </div>
        </div>
      </div>
      }
    </div>
  </div>
</div>
