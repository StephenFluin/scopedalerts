<div class="subscribe-container">
  <div class="header-section">
    <div class="header-content">
      <button class="back-btn" (click)="onBack()" aria-label="Go back">
        <svg class="back-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M19 12H5m7-7l-7 7 7 7"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
        </svg>
        Back
      </button>
      <div class="header-text">
        <h1>Manage Subscriptions</h1>
        <p>Select the products you want to receive notifications for.</p>
      </div>
    </div>
  </div>

  @if (loading()) {
  <div class="loading-container">
    <div class="loading-spinner">Loading products...</div>
  </div>
  } @else {
  <div class="content-section">
    <form class="subscription-form" (ngSubmit)="onSave()">
      @if (products().length === 0) {
      <div class="empty-state">
        <p>No products available for subscription.</p>
      </div>
      } @else {
      <div class="products-list">
        @for (product of products(); track product.id) {
        <label class="product-item">
          <input
            type="checkbox"
            [checked]="isProductSelected(product.id)"
            (change)="onProductToggle(product.id, $any($event.target).checked)"
            [disabled]="saving()"
            class="product-checkbox"
          />
          <div class="product-info">
            <h3 class="product-name">{{ product.name }}</h3>
            <p class="product-description">{{ product.description }}</p>
          </div>
        </label>
        }
      </div>

      <div class="form-actions">
        <button
          type="button"
          class="cancel-btn"
          (click)="onCancel()"
          [disabled]="!hasChanges() || saving()"
        >
          Cancel
        </button>
        <button type="submit" class="save-btn" [disabled]="!hasChanges() || saving()">
          @if (saving()) {
          <span class="btn-spinner">Saving...</span>
          } @else { Save Changes }
        </button>
      </div>
      }
    </form>
  </div>
  }
</div>
